<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>Cat 管理系统</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f5f5f5; }
        .container { max-width: 600px; margin: 40px auto; background: #fff; padding: 24px; border-radius: 8px; box-shadow: 0 2px 8px #0001; }
        h2 { text-align: center; }
        .form-group { margin-bottom: 16px; }
        label { display: block; margin-bottom: 4px; }
        input[type=text], input[type=password], input[type=number] { width: 100%; padding: 8px; box-sizing: border-box; }
        button { padding: 8px 16px; margin-right: 8px; }
        table { width: 100%; border-collapse: collapse; margin-top: 24px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background: #f0f0f0; }
        .error { color: #d00; margin-bottom: 12px; }
        .actions button { margin-right: 4px; }
        .logout { float: right; }
    </style>
</head>
<body>
<div class="container" id="app">
    <div id="login-view">
        <h2>登录</h2>
        <div class="error" id="login-error"></div>
        <div class="form-group">
            <label for="login-username">用户名</label>
            <input type="text" id="login-username" name="login-username">
        </div>
        <div class="form-group">
            <label for="login-password">密码</label>
            <input type="password" id="login-password" name="login-password">
        </div>
        <button onclick="login()">登录</button>
    </div>
    <div id="cat-view" style="display:none;">
        <h2>Cat 列表 <button class="logout" onclick="logout()">退出</button></h2>
        <div class="error" id="cat-error"></div>
        <table>
            <thead>
            <tr><th>ID</th><th>名字</th><th>年龄</th><th>品种</th><th>性别</th><th>体重</th><th>颜色</th><th>描述</th></tr>
            </thead>
            <tbody id="cat-list"></tbody>
        </table>
    </div>
    <nav style="margin-bottom:24px;">
        <button onclick="switchView('home')">首页</button>
        <button onclick="switchView('article')">资讯中心</button>
        <button onclick="switchView('encyclopedia')">宠物百科</button>
        <button onclick="switchView('community')">社区互动</button>
        <button onclick="switchView('service')">服务与资源</button>
        <button onclick="switchView('member')">会员中心</button>
        <button class="logout" onclick="logout()">退出</button>
    </nav>
    <div id="home-view" style="display:none;">
        <h2>🐾 宠物之家</h2>
        <div>欢迎来到宠物之家！这里有最新的宠物资讯、百科、社区互动和丰富的服务资源。</div>
        <div style="margin-top:20px;">
            <b>推荐文章：</b>
            <ul id="home-articles"></ul>
        </div>
        <div style="margin-top:20px;">
            <b>热门宠物：</b>
            <ul id="home-cats"></ul>
        </div>
    </div>
    <div id="article-view" style="display:none;">
        <h2>资讯中心</h2>
        <div id="article-list"></div>
    </div>
    <div id="encyclopedia-view" style="display:none;">
        <h2>宠物百科</h2>
        <div id="encyclopedia-list"></div>
    </div>
    <div id="community-view" style="display:none;">
        <h2>社区互动</h2>
        <div id="community-list"></div>
    </div>
    <div id="service-view" style="display:none;">
        <h2>服务与资源</h2>
        <div id="service-list"></div>
    </div>
    <div id="member-view" style="display:none;">
        <h2>会员中心</h2>
        <div id="member-info"></div>
        <div id="member-favorites"></div>
        <div id="member-score"></div>
    </div>
</div>
<script>
const API_BASE = '';

function show(view) {
    document.getElementById('login-view').style.display = view === 'login' ? '' : 'none';
    document.getElementById('cat-view').style.display = view === 'cat' ? '' : 'none';
    // 新增：切换宠物之家多模块页面
    const views = ['home', 'article', 'encyclopedia', 'community', 'service', 'member'];
    views.forEach(v => {
        const el = document.getElementById(v + '-view');
        if (el) el.style.display = view === v ? '' : 'none';
    });
}

function getToken() {
    return localStorage.getItem('token') || '';
}

function setToken(token) {
    if (token) localStorage.setItem('token', token);
    else localStorage.removeItem('token');
}

function showError(id, msg) {
    document.getElementById(id).textContent = msg || '';
}

function login() {
    showError('login-error', '');
    const username = document.getElementById('login-username').value.trim();
    const password = document.getElementById('login-password').value;
    fetch(API_BASE + '/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password })
    })
    .then(r => r.json().then(data => ({ok: r.ok, data})))
    .then(res => {
        if (res.ok && res.data.token) {
            setToken(res.data.token);
            show('cat');
            loadCats();
        } else {
            showError('login-error', res.data.error || '登录失败');
        }
    })
    .catch(() => showError('login-error', '网络错误'));
}

function logout() {
    setToken('');
    show('login');
}

function loadCats() {
    showError('cat-error', '');
    fetch(API_BASE + '/cats', {
        headers: { 'Authorization': 'Bearer ' + getToken() }
    })
    .then(r => r.json().then(data => ({ok: r.ok, data})))
    .then(res => {
        if (res.ok) {
            renderCatList(res.data);
        } else {
            showError('cat-error', res.data.error || '加载失败');
            if (res.data.error && res.data.error.includes('token')) logout();
        }
    })
    .catch(() => showError('cat-error', '网络错误'));
}

function renderCatList(cats) {
    const list = document.getElementById('cat-list');
    list.innerHTML = '';
    cats.forEach(cat => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${cat.id}</td><td>${cat.name}</td><td>${cat.age}</td>
            <td>${cat.breed || ''}</td><td>${cat.gender || ''}</td><td>${cat.weight || ''}</td>
            <td>${cat.color || ''}</td><td>${cat.description || ''}</td>`;
        list.appendChild(tr);
    });
}

function loadArticles() {
    fetch(API_BASE + '/articles', { headers: { 'Authorization': 'Bearer ' + getToken() } })
        .then(r => r.json())
        .then(data => {
            const div = document.getElementById('article-list');
            div.innerHTML = '<ul>' + (data || []).map(a =>
                `<li><b>${a.title}</b> [${a.category}]<br>${a.content}</li>`
            ).join('') + '</ul>';
        });
}
// 宠物百科
function loadEncyclopedias() {
    fetch(API_BASE + '/encyclopedias', { headers: { 'Authorization': 'Bearer ' + getToken() } })
        .then(r => r.json())
        .then(data => {
            const div = document.getElementById('encyclopedia-list');
            div.innerHTML = '<ul>' + (data || []).map(e => `<li><b>${e.title}</b> [${e.type}]<br>${e.content}</li>`).join('') + '</ul>';
        });
}
// 社区互动
function loadCommunity() {
    fetch(API_BASE + '/posts', { headers: { 'Authorization': 'Bearer ' + getToken() } })
        .then(r => r.json())
        .then(data => {
            const div = document.getElementById('community-list');
            div.innerHTML = '<ul>' + (data || []).map(p => `<li><b>用户${p.userId}</b> [${p.type}]<br>${p.content}</li>`).join('') + '</ul>';
        });
}
// 服务与资源
function loadService() {
    fetch(API_BASE + '/hospitals', { headers: { 'Authorization': 'Bearer ' + getToken() } })
        .then(r => r.json())
        .then(data => {
            const div = document.getElementById('service-list');
            div.innerHTML = '<b>宠物医院：</b><ul>' + (data || []).map(h => `<li><b>${h.name}</b> ${h.address} ${h.phone} 评分:${h.rating || '-'}<br>${h.description}</li>`).join('') + '</ul>';
        });
}
// 会员中心
function loadMember() {
    const username = localStorage.getItem('username');
    if (!username) return;
    fetch(API_BASE + '/users/' + username, { headers: { 'Authorization': 'Bearer ' + getToken() } })
        .then(r => r.json())
        .then(user => {
            document.getElementById('member-info').innerHTML = `<b>用户名：</b>${user.username}<br><b>积分：</b>${user.score || 0}<br><b>达人称号：</b>${user.role || ''}`;
        });
    fetch(API_BASE + '/users/' + username + '/favorites', { headers: { 'Authorization': 'Bearer ' + getToken() } })
        .then(r => r.json())
        .then(favs => {
            document.getElementById('member-favorites').innerHTML = '<b>收藏：</b>' + (favs && favs.length ? favs.join(', ') : '无');
        });
}

// 首页推荐文章和热门宠物加载
function loadHomeArticles() {
    fetch(API_BASE + '/articles', { headers: { 'Authorization': 'Bearer ' + getToken() } })
        .then(r => r.json())
        .then(data => {
            const ul = document.getElementById('home-articles');
            ul.innerHTML = '';
            (data || []).slice(0, 5).forEach(a => {
                const li = document.createElement('li');
                li.textContent = a.title;
                ul.appendChild(li);
            });
        });
    // 热门宠物
    fetch(API_BASE + '/cats', { headers: { 'Authorization': 'Bearer ' + getToken() } })
        .then(r => r.json())
        .then(data => {
            const ul = document.getElementById('home-cats');
            ul.innerHTML = '';
            (data || []).slice(0, 5).forEach(c => {
                const li = document.createElement('li');
                li.textContent = c.name + (c.breed ? '（' + c.breed + '）' : '');
                ul.appendChild(li);
            });
        });
}

// 切换视图
window.switchView = (view) => {
    show(view);
    // 根据不同view加载对应数据
    if (view === 'home') {
        loadHomeArticles();
        // 可扩展：加载热门宠物
    } else if (view === 'article') {
        loadArticles && loadArticles();
    } else if (view === 'encyclopedia') {
        loadEncyclopedias && loadEncyclopedias();
    } else if (view === 'community') {
        loadCommunity && loadCommunity();
    } else if (view === 'service') {
        loadService && loadService();
    } else if (view === 'member') {
        loadMember && loadMember();
    }
}

// ���动登录态判断
window.onload = function() {
    if (getToken()) {
        // 登录后默认进入首页
        show('home');
        switchView('home');
    } else {
        show('login');
    }
}
</script>
</body>
</html>
